name: PyLana Unit Tests

on:
  push: {branches: enhancement-auto-testing}

jobs:
  Install-and-test:
    strategy:
      matrix:
        os: [ubuntu-latest, macos-latest]
    runs-on: ${{ matrix.os }}

    env:
      CONDA: /root/miniconda3

    steps:
    - uses: actions/checkout@v2

    - name: Change conda permissions
      run: chmod +x .$CONDA/bin/conda

    - name: Set up conda environment
      run: $CONDA/bin/conda env update --file environment-dev.yaml --name base

    - name: Set up credentials
      run: |
        echo "{\"scheme\": \"https\",\"host\": \"cloud-backend.lanalabs.com\",\"port\": \"\",\"token\": \"${{ secrets.PYLANA_TEST_TOKEN }}\"}" > tests/config.json
        echo "{\"scheme\": \"https\",\"host\": \"cloud-backend.lanalabs.com\",\"port\": \"\",\"token\": \"${{ secrets.PYLANA_TEST_TOKEN }}\"}" > tests/config_useradmin.json

    - name: Test with pytest
      run: $CONDA/bin/pytest